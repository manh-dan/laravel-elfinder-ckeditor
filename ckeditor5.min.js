function elFinder(e,t="80%",n="80%"){elFinderTranslation(e.locale.language);const o="l1_Lw",r=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),i=e.commands.get("ckfinder"),l=e.plugins.get("FileRepository"),a=e.plugins.get("Notification"),c=e.locale.t,d=o=>new Promise(((i,l)=>{const d=()=>{o?Object.keys(s.files()).length?new Promise(((e,t)=>{s.file(o)?e():s.request({cmd:"parents",target:o}).done((n=>{s.file(o)?e():t()})).fail((()=>{t()}))})).then((()=>{s.exec("open",o).done((()=>{i(s)})).fail((e=>{l(s,e||"errFolderNotFound")}))})).catch((e=>{l(s,e||"errFolderNotFound")})):s.one("open",(()=>{s.file(o)?i(s):l(s,"errFolderNotFound")})):i(s)};s||(s=$("<div/>").dialogelfinder({title:"File Manager",url:"/elfinder/connector",startPathHash:o||void 0,useBrowserHistory:!1,autoOpen:!1,width:t,height:n,commandsOptions:{getfile:{oncomplete:"close",multiple:!0}},customData:{_token:r},lang:e.locale.language,resizable:!0,getFileCallback:(t,n)=>{let o=[];var r;n.getUI("cwd").trigger("unselectall"),$.each(t,(function(t,r){r&&r.mime.match(/^image\//i)?o.push(n.convAbsUrl(r.url)):e.execute("link",n.convAbsUrl(r.url))})),o.length&&(r=o,e.commands.get("imageUpload").isEnabled?e.execute("imageInsert",{source:r}):a.showWarning(c("Could not insert image at the current position."),{title:c("Inserting image failed"),namespace:"ckfinder"}))}}).elfinder("instance")),d()}));let s;i&&(i.execute=()=>{d().then((e=>{e.getUI().dialogelfinder("open")}))});const u=function(e){let t=function(e,t,n){d(o).then((i=>{let l=i.getUI();l.dialogelfinder("open"),i.exec("upload",{files:[e],target:o,headers:{"X-CSRF-TOKEN":r}},void 0,o).done((e=>{e.added&&e.added.length?i.url(e.added[0].hash,{async:!0}).done((function(e){t({default:i.convAbsUrl(e)}),l.dialogelfinder("close")})).fail((function(){n("errFileNotFound")})):(n(i.i18n(e.error?e.error:"errUpload")),l.dialogelfinder("close"))})).fail((e=>{const t=i.parseError(e);n(i.i18n(t?"userabort"===t?"errAbort":t:"errUploadNoFiles"))}))})).catch(((e,t)=>{const o=e.parseError(t);n(e.i18n(o?"userabort"===o?"errAbort":o:"errUploadNoFiles"))}))};this.upload=function(){return new Promise((function(n,o){e.file instanceof Promise||e.file&&"function"==typeof e.file.then?e.file.then((function(e){t(e,n,o)})):t(e.file,n,o)}))},this.abort=function(){s&&s.getUI().trigger("uploadabort")}};l.createUploadAdapter=e=>new u(e)}function elFinderTranslation(e){const t=document.createElement("script");t.src="/packages/barryvdh/elfinder/js/i18n/elfinder."+e+".js",t.type="text/javascript",t.defer=!0,document.head.appendChild(t)}
