function setupELFinder(e,t="80%",n="80%"){ELFinderTranslation(e.locale.language);let r="l1_Lw",l=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),i=e.commands.get("ckfinder"),o=e.plugins.get("FileRepository"),a=e.plugins.get("Notification"),d=e.locale.t,c=t=>{let n=e.commands.get("imageUpload");if(!n.isEnabled){a.showWarning(d("Could not insert image at the current position."),{title:d("Inserting image failed"),namespace:"ckfinder"});return}e.execute("imageInsert",{source:t})},s=r=>new Promise((i,o)=>{let a=()=>{r?Object.keys(u.files()).length?new Promise((e,t)=>{u.file(r)?e():u.request({cmd:"parents",target:r}).done(n=>{u.file(r)?e():t()}).fail(()=>{t()})}).then(()=>{u.exec("open",r).done(()=>{i(u)}).fail(e=>{o(u,e||"errFolderNotFound")})}).catch(e=>{o(u,e||"errFolderNotFound")}):u.one("open",()=>{u.file(r)?i(u):o(u,"errFolderNotFound")}):i(u)};u||(u=$("<div/>").dialogelfinder({title:"File Manager",url:"/elfinder/connector",startPathHash:r||void 0,useBrowserHistory:!1,autoOpen:!1,width:t,height:n,commandsOptions:{getfile:{oncomplete:"close",multiple:!0}},customData:{_token:l},lang:e.locale.language,resizable:!0,getFileCallback(t,n){let r=[];n.getUI("cwd").trigger("unselectall"),$.each(t,function(t,l){l&&l.mime.match(/^image\//i)?r.push(n.convAbsUrl(l.url)):e.execute("link",n.convAbsUrl(l.url))}),r.length&&c(r)}}).elfinder("instance")),a()}),u;i&&(i.execute=()=>{s().then(e=>{e.getUI().dialogelfinder("open")})});let f=function(e){let t=function(e,t,n){s(r).then(i=>{let o=i.getUI();o.dialogelfinder("open"),i.exec("upload",{files:[e],target:r,headers:{"X-CSRF-TOKEN":l}},void 0,r).done(e=>{e.added&&e.added.length?i.url(e.added[0].hash,{async:!0}).done(function(e){t({default:i.convAbsUrl(e)}),o.dialogelfinder("close")}).fail(function(){n("errFileNotFound")}):(n(i.i18n(e.error?e.error:"errUpload")),o.dialogelfinder("close"))}).fail(e=>{let t=i.parseError(e);n(i.i18n(t?"userabort"===t?"errAbort":t:"errUploadNoFiles"))})}).catch((e,t)=>{let r=e.parseError(t);n(e.i18n(r?"userabort"===r?"errAbort":r:"errUploadNoFiles"))})};this.upload=function(){return new Promise(function(n,r){e.file instanceof Promise||e.file&&"function"==typeof e.file.then?e.file.then(function(e){t(e,n,r)}):t(e.file,n,r)})},this.abort=function(){u&&u.getUI().trigger("uploadabort")}};o.createUploadAdapter=e=>new f(e)}function ELFinderTranslation(e){let t=document.createElement("script");t.src="/packages/barryvdh/elfinder/js/i18n/elfinder."+e+".js",t.type="text/javascript",t.defer=!0,document.head.appendChild(t)}
