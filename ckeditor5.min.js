function elFinder(e,t="80%",n="80%"){"en"!=e.locale.language&&elFinderTranslation(e.locale.language);let l="l1_Lw",r=document.querySelector('meta[name="csrf-token"]').getAttribute("content"),i=e.commands.get("ckfinder"),o=e.plugins.get("FileRepository"),a=e.plugins.get("Notification"),d=e.locale.t,c=t=>{let n=e.commands.get("imageUpload");if(!n.isEnabled){a.showWarning(d("Could not insert image at the current position."),{title:d("Inserting image failed"),namespace:"ckfinder"});return}e.execute("imageInsert",{source:t})},s=l=>new Promise((i,o)=>{let a=()=>{l?Object.keys(u.files()).length?new Promise((e,t)=>{u.file(l)?e():u.request({cmd:"parents",target:l}).done(n=>{u.file(l)?e():t()}).fail(()=>{t()})}).then(()=>{u.exec("open",l).done(()=>{i(u)}).fail(e=>{o(u,e||"errFolderNotFound")})}).catch(e=>{o(u,e||"errFolderNotFound")}):u.one("open",()=>{u.file(l)?i(u):o(u,"errFolderNotFound")}):i(u)};u||(u=$("<div/>").dialogelfinder({title:"File Manager",url:"/elfinder/connector",startPathHash:l||void 0,useBrowserHistory:!1,autoOpen:!1,width:t,height:n,commandsOptions:{getfile:{oncomplete:"close",multiple:!0}},customData:{_token:r},lang:e.locale.language,resizable:!0,getFileCallback(t,n){let l=[];n.getUI("cwd").trigger("unselectall"),$.each(t,function(t,r){r&&r.mime.match(/^image\//i)?l.push(n.convAbsUrl(r.url)):e.execute("link",n.convAbsUrl(r.url))}),l.length&&c(l)}}).elfinder("instance")),a()}),u;i&&(i.execute=()=>{s().then(e=>{e.getUI().dialogelfinder("open")})});let f=function(e){let t=function(e,t,n){s(l).then(i=>{let o=i.getUI();o.dialogelfinder("open"),i.exec("upload",{files:[e],target:l,headers:{"X-CSRF-TOKEN":r}},void 0,l).done(e=>{e.added&&e.added.length?i.url(e.added[0].hash,{async:!0}).done(function(e){t({default:i.convAbsUrl(e)}),o.dialogelfinder("close")}).fail(function(){n("errFileNotFound")}):(n(i.i18n(e.error?e.error:"errUpload")),o.dialogelfinder("close"))}).fail(e=>{let t=i.parseError(e);n(i.i18n(t?"userabort"===t?"errAbort":t:"errUploadNoFiles"))})}).catch((e,t)=>{let l=e.parseError(t);n(e.i18n(l?"userabort"===l?"errAbort":l:"errUploadNoFiles"))})};this.upload=function(){return new Promise(function(n,l){e.file instanceof Promise||e.file&&"function"==typeof e.file.then?e.file.then(function(e){t(e,n,l)}):t(e.file,n,l)})},this.abort=function(){u&&u.getUI().trigger("uploadabort")}};o.createUploadAdapter=e=>new f(e)}function elFinderTranslation(e){let t=document.createElement("script");t.src="/packages/barryvdh/elfinder/js/i18n/elfinder."+e+".js",t.type="text/javascript",t.defer=!0,document.head.appendChild(t)}
