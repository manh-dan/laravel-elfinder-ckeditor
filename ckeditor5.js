function setupELFinder(e,t="en"){loadElfinderLangScript(t);let n="l1_Lw",r=e.commands.get("ckfinder"),i=e.plugins.get("FileRepository"),o=e.plugins.get("Notification"),l=e.locale.t,a=t=>{let n=e.commands.get("imageUpload");if(!n.isEnabled){o.showWarning(l("Could not insert image at the current position."),{title:l("Inserting image failed"),namespace:"ckfinder"});return}e.execute("imageInsert",{source:t})},d=n=>new Promise((r,i)=>{let o=()=>{n?Object.keys(c.files()).length?new Promise((e,t)=>{c.file(n)?e():c.request({cmd:"parents",target:n}).done(r=>{c.file(n)?e():t()}).fail(()=>{t()})}).then(()=>{c.exec("open",n).done(()=>{r(c)}).fail(e=>{i(c,e||"errFolderNotFound")})}).catch(e=>{i(c,e||"errFolderNotFound")}):c.one("open",()=>{c.file(n)?r(c):i(c,"errFolderNotFound")}):r(c)};c||(c=$("<div/>").dialogelfinder({title:"File Manager",url:"/elfinder/connector",startPathHash:n||void 0,useBrowserHistory:!1,autoOpen:!1,width:"80%",commandsOptions:{getfile:{oncomplete:"close",multiple:!0}},customData:{_token:document.querySelector('meta[name="csrf-token"]').getAttribute("content")},lang:t,getFileCallback(t,n){let r=[];n.getUI("cwd").trigger("unselectall"),$.each(t,function(t,i){i&&i.mime.match(/^image\//i)?r.push(n.convAbsUrl(i.url)):e.execute("link",n.convAbsUrl(i.url))}),r.length&&a(r)}}).elfinder("instance")),o()}),c;r&&(r.execute=()=>{d().then(e=>{e.getUI().dialogelfinder("open")})});let s=function(e){let r=function(e,r,i){d(n,t).then(t=>{let o=t.getUI();o.dialogelfinder("open"),t.exec("upload",{files:[e],target:n,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}},void 0,n).done(e=>{e.added&&e.added.length?t.url(e.added[0].hash,{async:!0}).done(function(e){r({default:t.convAbsUrl(e)}),o.dialogelfinder("close")}).fail(function(){i("errFileNotFound")}):(i(t.i18n(e.error?e.error:"errUpload")),o.dialogelfinder("close"))}).fail(e=>{let n=t.parseError(e);i(t.i18n(n?"userabort"===n?"errAbort":n:"errUploadNoFiles"))})}).catch((e,t)=>{let n=e.parseError(t);i(e.i18n(n?"userabort"===n?"errAbort":n:"errUploadNoFiles"))})};this.upload=function(){return new Promise(function(t,n){e.file instanceof Promise||e.file&&"function"==typeof e.file.then?e.file.then(function(e){r(e,t,n)}):r(e.file,t,n)})},this.abort=function(){c&&c.getUI().trigger("uploadabort")}};i.createUploadAdapter=e=>new s(e)}function loadElfinderLangScript(e){if("en"!=e){let t=document.createElement("script");t.src="/packages/barryvdh/elfinder/js/i18n/elfinder."+e+".js",t.type="text/javascript",t.defer=!0,document.head.appendChild(t)}}
