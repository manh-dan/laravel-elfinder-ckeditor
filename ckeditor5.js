function setupELFinder(e,t,n,r="en"){loadElfinderLangScript(r);let i=e.commands.get("ckfinder"),o=e.plugins.get("FileRepository"),l=e.plugins.get("Notification"),a=e.locale.t,d=t=>{let n=e.commands.get("imageUpload");if(!n.isEnabled){l.showWarning(a("Could not insert image at the current position."),{title:a("Inserting image failed"),namespace:"ckfinder"});return}e.execute("imageInsert",{source:t})},c=n=>new Promise((i,o)=>{let l=()=>{n?Object.keys(s.files()).length?new Promise((e,t)=>{s.file(n)?e():s.request({cmd:"parents",target:n}).done(r=>{s.file(n)?e():t()}).fail(()=>{t()})}).then(()=>{s.exec("open",n).done(()=>{i(s)}).fail(e=>{o(s,e||"errFolderNotFound")})}).catch(e=>{o(s,e||"errFolderNotFound")}):s.one("open",()=>{s.file(n)?i(s):o(s,"errFolderNotFound")}):i(s)};s||(s=$("<div/>").dialogelfinder({title:"File Manager",url:t,startPathHash:n||void 0,useBrowserHistory:!1,autoOpen:!1,width:"80%",commandsOptions:{getfile:{oncomplete:"close",multiple:!0}},customData:{_token:document.querySelector('meta[name="csrf-token"]').getAttribute("content")},lang:r,getFileCallback(t,n){let r=[];n.getUI("cwd").trigger("unselectall"),$.each(t,function(t,i){i&&i.mime.match(/^image\//i)?r.push(n.convAbsUrl(i.url)):e.execute("link",n.convAbsUrl(i.url))}),r.length&&d(r)}}).elfinder("instance")),l()}),s;i&&(i.execute=()=>{c().then(e=>{e.getUI().dialogelfinder("open")})});let f=function(e){let t=function(e,t,i){c(n,r).then(r=>{let o=r.getUI();o.dialogelfinder("open"),r.exec("upload",{files:[e],target:n,headers:{"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")}},void 0,n).done(e=>{e.added&&e.added.length?r.url(e.added[0].hash,{async:!0}).done(function(e){t({default:r.convAbsUrl(e)}),o.dialogelfinder("close")}).fail(function(){i("errFileNotFound")}):(i(r.i18n(e.error?e.error:"errUpload")),o.dialogelfinder("close"))}).fail(e=>{let t=r.parseError(e);i(r.i18n(t?"userabort"===t?"errAbort":t:"errUploadNoFiles"))})}).catch((e,t)=>{let n=e.parseError(t);i(e.i18n(n?"userabort"===n?"errAbort":n:"errUploadNoFiles"))})};this.upload=function(){return new Promise(function(n,r){e.file instanceof Promise||e.file&&"function"==typeof e.file.then?e.file.then(function(e){t(e,n,r)}):t(e.file,n,r)})},this.abort=function(){s&&s.getUI().trigger("uploadabort")}};o.createUploadAdapter=e=>new f(e)}function loadElfinderLangScript(e){if("en"!=e){let t=document.createElement("script");t.src="/packages/barryvdh/elfinder/js/i18n/elfinder."+e+".js",t.type="text/javascript",t.defer=!0,document.head.appendChild(t)}}
